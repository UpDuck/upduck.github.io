
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Moving outside the box &#8212; Up Duck 0.0.1 documentation</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Deck commands" href="../commands.html" />
    <link rel="prev" title="Working with Elgato Stream Deck" href="stream-deck.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="moving-outside-the-box">
<h1>Moving outside the box<a class="headerlink" href="#moving-outside-the-box" title="Permalink to this headline">¶</a></h1>
<div class="section" id="security-prefix">
<h2>Security Prefix<a class="headerlink" href="#security-prefix" title="Permalink to this headline">¶</a></h2>
<p>UP Deck, while well intentioned is not secure.</p>
<p># Communications are over plain text TCP
# The password is barely obfuscated
# Commands are not allow-listed, the client can do whatever it wants to do that has an exposed interface
# The HTTP server is custom-built and isn’t as robust as common HTTP servers
# There are interfaces for, spawning processes, calling remote URLs, and killing others.</p>
<p>Someone could, if they where so determined and had access, write commands to download data from the internet and launch it. A security minded person, would rightfully consider this as a remote code execution (RCE) exploit waiting to happen.</p>
<p>This risk is currently greatly limited by the environment and implementation:</p>
<ul class="simple">
<li><p>the client uses an custom TCP protocol that requires specific knowledge to
take advantage of.</p></li>
<li><p>HTTP server even if exposed can only edit decks and can not run them.</p></li>
<li><p>Expectation that the user is operating on a private WiFi network (although
plenty of IoT things are compromised on them)</p></li>
</ul>
<p>The gives an overall low risk from Up Deck. However the moment the HTTP server can also remotely trigger buttons, then its a medium trending towards high. If you then turn around and make that interface directly available on the internet (like by forwarding the port on your router) that risk becomes very high.</p>
<blockquote>
<div><p>If you then turn around and make that interface directly available
on the internet (like by forwarding the port on your router) that risk
becomes very high.</p>
</div></blockquote>
<p>Why does HTTP increase this risk so much? HTTP is a well known, and is an easy to walk protocol, it provides rapid feedback to an actor and as such, much of the tools for exploiting the internet are based these easy exploit methods.</p>
<p>Care would need to be taken in exposing the execute side of the deck, and even more care should be taken if you take the non-recommended course of exposing it to the internet.</p>
</div>
<div class="section" id="reducing-risk">
<h2>Reducing Risk<a class="headerlink" href="#reducing-risk" title="Permalink to this headline">¶</a></h2>
<p>The lecture above aside, steps can be taken to reduce risk if you still want
to go down this path (and there are valid reasons to do so) We’d propose that
you take the following into account (using nomenclature from <span class="target" id="index-0"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc2119.html"><strong>RFC 2119</strong></a>):</p>
<div class="section" id="client-app">
<h3>Client App<a class="headerlink" href="#client-app" title="Permalink to this headline">¶</a></h3>
<p>The client app interface uses a dedicated port (default: 4445) to communicate
over a raw TCP connection in clear text (unencrypted). Data exchanged over
this interface will be processed by the server without question.</p>
<ul class="simple">
<li><p>The interface MUST be password protected if you are extending its scope</p></li>
<li><p>The interface MUST NOT be exposed to the public internet</p></li>
<li><p>The interface SHOULD NOT be expanded beyond the local network</p>
<ul>
<li><p>In the off chance you think this is important you MUST do this over
encrypted tunneling (VPN).</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="http-server">
<h3>HTTP Server<a class="headerlink" href="#http-server" title="Permalink to this headline">¶</a></h3>
<p>The http server has various urls that have different sensitivity, they can be
classified as <strong>config</strong>, <strong>edit</strong>, and <strong>execute</strong>, which have different risks.</p>
<ul class="simple">
<li><p>The HTTP Server MUST NOT be generically exposed to the internet.</p></li>
</ul>
<div class="section" id="config">
<h4>Config<a class="headerlink" href="#config" title="Permalink to this headline">¶</a></h4>
<p>The config urls, including <code class="docutils literal notranslate"><span class="pre">/,</span> <span class="pre">/setup,</span></code> are very sensitive and MUST NOT be
exposed. As they can change ports, passwords and lock users out.</p>
</div>
<div class="section" id="edit">
<h4>Edit<a class="headerlink" href="#edit" title="Permalink to this headline">¶</a></h4>
<p>The <strong>edit</strong> urls including <code class="docutils literal notranslate"><span class="pre">/deck,</span> <span class="pre">/schedule</span></code> are used to configure decks,
or setup reoccurring commands.</p>
<ul class="simple">
<li><p>The <strong>edit</strong> interface MUST be password protected to prevent un-authorized
modification</p></li>
<li><p>The edit** interface SHOULD be segregated (with at least a separate password)
from the <strong>setup</strong></p></li>
<li><p>The <strong>edit</strong> interface SHOULD be segregated from the <strong>execute</strong> interface</p></li>
<li><p>The <strong>edit</strong> interface SHOULD NOT be exposed to the public internet</p></li>
<li><ul>
<li><p>The <strong>edit</strong> interface SHOULD be exposed over TLS</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="execute">
<h4>Execute<a class="headerlink" href="#execute" title="Permalink to this headline">¶</a></h4>
<p>The <strong>execute</strong> urls, including <code class="docutils literal notranslate"><span class="pre">/xdeck/,</span> <span class="pre">/live,</span> <span class="pre">/liveDeck</span></code> are used to
provide an interface to executing existing decks. Given careful construction
of decks and access to them, the risk can become very minimal.</p>
<p>Each of the urls has a path parmater to the deck in use, this can be useful
in configuring access controls to only specific decks:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">xdeck</span><span class="o">/</span><span class="p">{</span><span class="n">deck</span><span class="p">}</span><span class="o">/</span><span class="p">{</span><span class="n">buttonNumber</span><span class="p">}</span>
<span class="o">/</span><span class="n">live</span><span class="o">/</span><span class="p">{</span><span class="n">deck</span><span class="p">}</span><span class="o">/...</span>
<span class="o">/</span><span class="n">liveDeck</span><span class="o">/</span><span class="p">{</span><span class="n">deck</span><span class="p">}</span><span class="o">/...</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The <strong>execute</strong> interface MAY be exposed to the internet</p>
<ul>
<li><p>The <strong>execute</strong> interface SHOULD be restricted by access control function
(password, IP allow list, etc…)</p></li>
<li><p>The <strong>execute</strong> interface SHOULD be restricted to specific decks</p></li>
<li><p>The <strong>execute</strong> interface SHOULD be exposed over TLS</p></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="section" id="options-to-expose-your-decks">
<h2>Options to expose your decks<a class="headerlink" href="#options-to-expose-your-decks" title="Permalink to this headline">¶</a></h2>
<p>Exposing one of the <strong>execute</strong> urls should be relatively straightforward for
the running a HTTP service on the internet.</p>
<p>You will need to set up a more mature HTTP server as a proxy to handle
traffic before it gets sent to UP Deck.</p>
<p>A good proxy will allow you you:</p>
<ul class="simple">
<li><p>Terminate TLS traffic</p></li>
<li><p>Apply simple access controls to paths</p></li>
<li><p>Rewrite paths if you desire</p></li>
<li><p>Access logs</p></li>
</ul>
<p>This gives you a flow like</p>
<p>Internet –&gt; Your Router –&gt; proxy –&gt; UP Deck HTTP</p>
<p>There are a myriad of tutorials on the internet for setting up a home http proxy for your webserver.</p>
<p>Some reccomended proxies are:</p>
<ul class="simple">
<li><p>Nginix - this guy powers a large portion of the internet. Its a little more
complex, but it does everything</p></li>
<li><p>Node - this can be done as a simple proxy wrapper, not much feature wise
but if you already have node and are only on a private network, its fine</p></li>
<li><p>python http.server - another simple one, would be fine for private networks</p></li>
</ul>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">Up Duck</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/intro-to-buttons.html">Introduction to buttons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/intro-to-commands.html">Introduction to commands</a></li>
</ul>
<p class="caption"><span class="caption-text">Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="stream-deck.html">Working with Elgato Stream Deck</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Moving outside the box</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with commands</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../commands.html">Deck commands</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="stream-deck.html" title="previous chapter">Working with Elgato Stream Deck</a></li>
      <li>Next: <a href="../commands.html" title="next chapter">Deck commands</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Andrew Woodawrd (xarses).
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/updeck/guides/moving-outside-the-box.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>